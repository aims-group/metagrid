# https://hub.docker.com/r/library/node/tags/
image: node:latest
#This declares the pipeline stages
stages:
  - build
  - test
  - deploy

# This folder is cached between builds
# http://docs.gitlab.com/ce/ci/yaml/README.html#cache
# Change yarns's cache directory to be inside the project directory since we can
# only cache local items.
variables:
  YARN_CACHE_FOLDER: '$CI_PROJECT_DIR/.yarn'

# This folder is cached between builds
# http://docs.gitlab.com/ce/ci/yaml/README.html#cache
# Cache modules in between jobs
cache:
  key: ${CI_COMMIT_REF_SLUG}
  paths:
    - .yarn

build:
  stage: build
  before_script:
    - cd frontend
    - yarn config set cache-folder $YARN_CACHE_FOLDER
    - yarn install
  script:
    - yarn build

test:
  stage: test
  before_script:
    - cd frontend
    - yarn config set cache-folder $YARN_CACHE_FOLDER
    - yarn install --frozen-lockfile
  script:
    - yarn test-coverage
